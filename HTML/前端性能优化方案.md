# 前端性能优化方案
前端优化相对比较复杂，对于各种资源的优化都有不同的方式，按粒度大致可以分为两类，一类是页面级别的优化，一类是代码级别的优化。下面会从减少HTTP请求，利用缓存机制，优化资源加载，优化代码方案，压缩资源文件，优化网络请求这几个方面来说明。

## 减少HTTP请求
加载前端的大部分时间在于下载各种资源，浏览器对于同一个服务器的HTTP请求连接池数量也是有限的，对于过多的请求需要排队等候，最小化HTTP请求减少请求次数可以防止HTTP连接池被占满，同时也能避免过多HTTP链接时的TCP握手造成的时间消耗。

### CSS Sprite
CSS Sprite也就是俗称的雪碧图，将多张图片合并到一张图片中，可以减少请求的图片数量

### Font icon
使用字体图标来代替图标，将多个图标合成为字体图标不仅可以减少对于图片的HTTP请求数量与图标大小，还作为矢量图对于放大缩小等操作不会失真

### Combined files
Combined files也就是合并文件，将多个CSS文件或者JavaScript文件合并成一个CSS文件或者JavaScript文件，可以有效减少HTTP请求数量，并且可以通过压缩算法减小文件的大小。

## 利用缓存机制

### 缓存控制
通过服务器端设置响应头的Expires与Cache-Control来设置资源组件过期时间以及过期策略，对于静态资源可以通过设置Expires为一个长期时间来实现永不过期策略，对于动态组件通过Cache-Control指定缓存机制来辅助浏览器处理条件请求。

### 外部引用
将JavaScript与CSS设置为外部文件引入而不是直接嵌入到HTML中，由于浏览器的缓存机制，外部文件可以通过浏览器的缓存引入而不需要每次请求重复请求同一个资源文件，这样就使得浏览器在第二次打开页面的速度会快得多，当然全部由外部文件引入的方式会增加HTTP请求数量，所以外部引用的关键问题就在于如何权衡相对于HTML文档数量而言，缓存外部JavaScript与CSS文件的数量

## 优化资源加载
### 样式表位置
根据浏览器渲染的顺序，将CSS在<head>中引入或者嵌入，相对于将CSS放到<body>或者页面底部来说，可以使页面渲染速度加快，这对于页面内容比较丰富的网站或者网络链接较慢时相当重要。

### 脚本位置
浏览器是可以并发请求的，这一特点使得其能够更快的加载资源，然而外部引入JavaScript脚本在加载时却会阻塞其他资源，例如在脚本加载完成之前，它后面的图片、样式以及其他脚本都处于阻塞状态，直到脚本加载完成后才会开始加载。解决这些问题的方法有很多例如异步加载脚本等，而最简单可依赖的方法就是将脚本尽可能的往后挪，减少对并发下载与页面渲染的影响。

- defer属性：将脚本文件设置为延时加载，会新开线程去下载JS文件，同时继续解析HTML文档，等HTML全部解析完毕DOM加载完成之后，再去执行JS文件。

- async属性：async属性和defer属性类似，也是会开启一个线程去下载js文件，但和defer不同的时，它会在下载完成后立刻执行，而不是会等到DOM加载完成之后再执行，所以还是有可能会造成阻塞。它不能像defer那样保证按顺序执行，它是哪个js文件先下载完就先执行哪个。

- 动态创建```<script>```标签

## 优化代码方案
### 避免CSS表达式
CSS表达式通过expression方法来接受JavaScript表达式，是一种动态设置CSS的强大的方式，但同样也是非常危险的方式，CSS表达式的问题在于其会进行频繁的计算，CSS计算的频率要远远超出我们的想象，不仅在页面显示和缩放时会进行计算，在页面滚动或者移动鼠标都会重新计算一次，从而影响到页面的性能。

### 最小化操作DOM
JavaScript操作DOM无可避免的会触发浏览器的重绘或者回流，由于重绘和回流可能代价比较昂贵，因此最好就是可以减少它的发生次数，为了减少发生次数，我们可以合并多次对DOM和样式的修改，然后一次处理掉，或者将样式事先设计好，动态去改变class。

## 压缩资源文件
### Gzip
从HTTP / 1.1开始，客户端可以通过使用HTTP请求中的Accept-Encoding: gzip, deflate来指示对压缩的支持。如果服务器在请求中看到此标头，则可以使用客户端列出的方法之一压缩响应，服务器通过响应中的Content-Encoding: gzip通知客户端采用gzip压缩。Gzip的压缩率很高，是目前最流行，最有效的压缩方法，它由GNU项目开发，并由RFC 1952标准化。

### 压缩外部文件
压缩JavaScript和CSS文件，从代码中删除不必要的字符以减小其大小，从而缩短加载时间，当代码最小化时，所有注释以及不需要的空白字符都将被删除，由于减小了下载文件的大小，因此可以提高响应时间性能。

## 优化网络请求

### CDN
CDN的全称是Content Delivery Network，即内容分发网络，CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率

### DNS预解析
当浏览器访问一个域名的时候，需要解析一次DNS，获得对应域名的ip地址。在解析过程中，按照浏览器缓存、系统缓存、路由器缓存、ISP(运营商)DNS缓存、根域名服务器、顶级域名服务器、主域名服务器的顺序，逐步读取缓存，直到拿到IP地址，DNS Prefetch，即DNS预解析就是根据浏览器定义的规则，提前解析之后可能会用到的域名，使解析结果缓存到系统缓存中，缩短DNS解析时间，来提高网站的访问速度
```
<link rel="dns-prefecth" href="https://www.google.com">
<link rel="dns-prefecth" href="https://www.google-analytics.com">
```
提前解析DNS，由于它是并行的，不会堵塞页面渲染，这样可以缩短资源加载的时间

### 配置Etag
实体标签ETag是Web服务器和浏览器用来确定浏览器缓存中的资源是否与原始服务器上的资源匹配的一种机制，添加了ETag，以提供一种比上次修改日期更灵活的验证实体的机制。ETag是唯一标识组件特定版本的字符串，唯一的格式限制是用引号引起来，原始服务器使用ETag响应头指定组件的ETag

### 尽早释放缓冲
当用户请求页面时，后端服务器将HTML页面拼接在一起可能需要200到500毫秒的时间，在这段时间内，浏览器在等待数据到达时处于空闲状态，这段时间则可以将服务端部分已经处理好的数据发送到前端，使浏览器先开始加载外部资源。例如使用PHP，则可以使用函数flush()将部分就绪的HTML响应发送到浏览器，以便浏览器可以在后端忙于处理HTML页面的其余部分时开始获取资源，好处主要体现在繁忙的后端或轻量级前端。